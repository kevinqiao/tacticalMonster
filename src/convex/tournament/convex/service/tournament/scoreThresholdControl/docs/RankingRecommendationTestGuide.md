# æ¨èæ’åç³»ç»Ÿæµ‹è¯•æŒ‡å—

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•å…¨é¢æµ‹è¯•æ¨èæ’åç³»ç»Ÿçš„åŠŸèƒ½ã€æ€§èƒ½å’Œå¯é æ€§ã€‚ç³»ç»Ÿæä¾›äº†å¤šå±‚æ¬¡çš„æµ‹è¯•å·¥å…·ï¼Œä»å•å…ƒæµ‹è¯•åˆ°é›†æˆæµ‹è¯•ï¼Œä»åŠŸèƒ½éªŒè¯åˆ°æ€§èƒ½åŸºå‡†æµ‹è¯•ã€‚

## ğŸ§ª æµ‹è¯•æ–‡ä»¶ç»“æ„

```
test/
â”œâ”€â”€ RankingRecommendationTest.ts     # å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ˆæ¨¡æ‹Ÿç¯å¢ƒï¼‰
â”œâ”€â”€ TestRunner.ts                    # å®é™…ç¯å¢ƒæµ‹è¯•è¿è¡Œå™¨
â””â”€â”€ ../functions/testRankingRecommendation.ts  # Convexå‡½æ•°æµ‹è¯•æ¥å£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åœ¨Convex Dashboardä¸­è¿è¡Œæµ‹è¯•

æœ€ç®€å•çš„æ–¹å¼æ˜¯åœ¨Convex Dashboardä¸­ç›´æ¥è°ƒç”¨æµ‹è¯•å‡½æ•°ï¼š

```javascript
// å¿«é€ŸéªŒè¯æµ‹è¯•
await ctx.runMutation("scoreThresholdControl:runQuickRankingTest", {});

// å®Œæ•´æµ‹è¯•å¥—ä»¶
await ctx.runMutation("scoreThresholdControl:runFullRankingTest", {});
```

### 2. æµ‹è¯•å•ä¸ªç©å®¶æ’å

```javascript
// æµ‹è¯•ä¸“å®¶çº§ç©å®¶
await ctx.runMutation("scoreThresholdControl:testSinglePlayerRanking", {
    uid: "expert_player_001",
    score: 12000,
    aiCount: 5
});

// æµ‹è¯•æ–°æ‰‹ç©å®¶
await ctx.runMutation("scoreThresholdControl:testSinglePlayerRanking", {
    uid: "newbie_player_001", 
    score: 3000,
    aiCount: 5
});
```

### 3. æµ‹è¯•å¤šç©å®¶åœºæ™¯

```javascript
await ctx.runMutation("scoreThresholdControl:testMultiPlayerRanking", {
    players: [
        { uid: "player_001", score: 12000 },
        { uid: "player_002", score: 8500 },
        { uid: "player_003", score: 5000 }
    ],
    aiCount: 3
});
```

## ğŸ“Š æµ‹è¯•ç±»å‹è¯¦è§£

### 1. åŠŸèƒ½éªŒè¯æµ‹è¯•

#### **å•ç©å®¶æ’åæ¨è**
- **æµ‹è¯•ç›®æ ‡**: éªŒè¯å•ä¸ªç©å®¶çš„æ’åæ¨èå‡†ç¡®æ€§
- **æµ‹è¯•å†…å®¹**: 
  - æ¨èæ’ååˆç†æ€§
  - ä¿¡å¿ƒåº¦è®¡ç®—
  - AIå¯¹æ‰‹ç”Ÿæˆ
  - ç›¸å¯¹è¡¨ç°è¯„ä¼°

```typescript
// ç¤ºä¾‹ç»“æœ
{
    success: true,
    player: {
        uid: "expert_001",
        recommendedRank: 2,
        confidence: 0.85,
        relativePerformance: "excellent",
        reasoning: "å½“å‰è¡¨ç°ä¼˜å¼‚ï¼ˆå¾—åˆ†12000ï¼‰ï¼Œæ¯”å†å²å¹³å‡æå‡15.2%..."
    },
    aiOpponents: [
        { uid: "ai_1", rank: 1, score: 12500, difficulty: "extreme" },
        { uid: "ai_2", rank: 3, score: 11500, difficulty: "hard" }
        // ...
    ]
}
```

#### **å¤šç©å®¶æ’åæ¨è**
- **æµ‹è¯•ç›®æ ‡**: éªŒè¯å¤šç©å®¶é—´çš„æ’åé€»è¾‘
- **æµ‹è¯•å†…å®¹**:
  - åˆ†æ•°æ’åºä¸€è‡´æ€§
  - ç›¸å¯¹æ’ååˆç†æ€§
  - AIå¡«å……é€»è¾‘
  - æŠ€èƒ½æ°´å¹³é€‚é…

#### **Controlleræ¥å£æµ‹è¯•**
- **æµ‹è¯•ç›®æ ‡**: éªŒè¯å¯¹å¤–APIçš„ç¨³å®šæ€§
- **æµ‹è¯•å†…å®¹**:
  - æ¥å£å“åº”æ ¼å¼
  - é”™è¯¯å¤„ç†æœºåˆ¶
  - å…¼å®¹æ€§ä¿è¯

### 2. æŠ€èƒ½æ°´å¹³æµ‹è¯•

#### **ä¸åŒæ°´å¹³ç©å®¶å¯¹æ¯”**
```javascript
await ctx.runMutation("scoreThresholdControl:compareSkillLevelRankings", {
    testScores: [3000, 6000, 9000, 12000], // æ–°æ‰‹åˆ°ä¸“å®¶
    aiCount: 5
});
```

**é¢„æœŸç»“æœ**:
- æ–°æ‰‹ç©å®¶(3000åˆ†): æ›´å¤šæ”¯æŒæ€§AIï¼Œè¾ƒä½æ’åæœŸæœ›
- ä¸­çº§ç©å®¶(6000-9000åˆ†): å¹³è¡¡çš„AIé…ç½®
- ä¸“å®¶ç©å®¶(12000åˆ†): æ›´å¤šæŒ‘æˆ˜æ€§AIï¼Œè¾ƒé«˜æ’åæœŸæœ›

#### **è¡¨ç°ä¸€è‡´æ€§æµ‹è¯•**
- **æµ‹è¯•ç›®æ ‡**: éªŒè¯ç›¸åŒè¾“å…¥çš„æ¨èä¸€è‡´æ€§
- **æ–¹æ³•**: å¤šæ¬¡è¿è¡Œç›¸åŒå‚æ•°çš„æ¨è
- **æ ‡å‡†**: æ ‡å‡†å·® < 1.5

### 3. è¾¹ç•Œæ¡ä»¶æµ‹è¯•

#### **æç«¯åˆ†æ•°æµ‹è¯•**
```javascript
// æµ‹è¯•æç«¯æƒ…å†µ
const extremeScores = [0, 1, 100, 50000, 999999];
```

#### **æç«¯å‚ä¸è€…æ•°é‡**
```javascript
// æµ‹è¯•ä¸åŒè§„æ¨¡æ¯”èµ›
const participantCounts = [2, 4, 8, 12, 20];
```

#### **ç›¸åŒåˆ†æ•°å¤„ç†**
```javascript
// æµ‹è¯•åˆ†æ•°ç›¸åŒçš„å¤šä¸ªç©å®¶
const samePlayers = [
    { uid: "player_1", score: 8000 },
    { uid: "player_2", score: 8000 },
    { uid: "player_3", score: 8000 }
];
```

### 4. æ€§èƒ½åŸºå‡†æµ‹è¯•

#### **å“åº”æ—¶é—´æµ‹è¯•**
- **ç›®æ ‡**: å¹³å‡å“åº”æ—¶é—´ < 100ms
- **æ–¹æ³•**: è¿ç»­æ‰§è¡Œå¤šæ¬¡æ¨èï¼Œè®¡ç®—å¹³å‡æ—¶é—´
- **æŒ‡æ ‡**: QPS (æ¯ç§’æŸ¥è¯¢æ•°)

#### **å¹¶å‘æ€§èƒ½æµ‹è¯•**
- **ç›®æ ‡**: éªŒè¯å¹¶å‘è¯·æ±‚å¤„ç†èƒ½åŠ›
- **æ–¹æ³•**: åŒæ—¶æ‰§è¡Œå¤šä¸ªæ¨èä»»åŠ¡
- **æŒ‡æ ‡**: æˆåŠŸç‡ã€å¹³å‡å“åº”æ—¶é—´

## ğŸ”§ æµ‹è¯•é…ç½®

### æµ‹è¯•æ•°æ®é…ç½®

æµ‹è¯•ç³»ç»Ÿä½¿ç”¨æ¨¡æ‹Ÿçš„å†å²æ•°æ®ï¼š

```typescript
// ä¸“å®¶çº§ç©å®¶æ•°æ®
const expertData = [
    { score: 12000, rank: 1, segmentName: 'diamond' },
    { score: 11500, rank: 2, segmentName: 'diamond' },
    // ... æ›´å¤šå†å²æ•°æ®
];

// æ–°æ‰‹ç©å®¶æ•°æ®  
const beginnerData = [
    { score: 3200, rank: 5, segmentName: 'bronze' },
    { score: 3000, rank: 6, segmentName: 'bronze' },
    // ... æ›´å¤šå†å²æ•°æ®
];
```

### æ–­è¨€å’ŒéªŒè¯

æµ‹è¯•ç³»ç»ŸåŒ…å«å…¨é¢çš„æ–­è¨€æœºåˆ¶ï¼š

```typescript
// åŸºæœ¬éªŒè¯
this.assert(result.success, 'æ¨èåº”è¯¥æˆåŠŸ');
this.assert(rank >= 1 && rank <= totalParticipants, 'æ’ååº”åœ¨æœ‰æ•ˆèŒƒå›´å†…');

// é€»è¾‘éªŒè¯
this.assert(expertRank < newbieRank, 'ä¸“å®¶æ’ååº”è¯¥ä¼˜äºæ–°æ‰‹');
this.assert(confidence > 0.5, 'ä¸“å®¶ç©å®¶ä¿¡å¿ƒåº¦åº”è¯¥è¾ƒé«˜');

// æ•°æ®å®Œæ•´æ€§éªŒè¯
this.validateMatchRankingResult(result);
```

## ğŸ“ˆ æµ‹è¯•ç»“æœåˆ†æ

### æˆåŠŸæ ‡å‡†

#### **åŠŸèƒ½æµ‹è¯•**
- âœ… æ‰€æœ‰åŸºæœ¬åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æ’åé€»è¾‘ç¬¦åˆé¢„æœŸ
- âœ… AIç”Ÿæˆåˆç†
- âœ… é”™è¯¯å¤„ç†æ­£ç¡®

#### **æ€§èƒ½æµ‹è¯•**
- âœ… å¹³å‡å“åº”æ—¶é—´ < 100ms
- âœ… QPS > 10
- âœ… 99%çš„è¯·æ±‚æˆåŠŸ
- âœ… å†…å­˜ä½¿ç”¨ç¨³å®š

#### **ä¸€è‡´æ€§æµ‹è¯•**
- âœ… ç›¸åŒè¾“å…¥æ¨èä¸€è‡´ (æ ‡å‡†å·® < 1.5)
- âœ… åˆ†æ•°æ’åºé€»è¾‘æ­£ç¡®
- âœ… è¾¹ç•Œæ¡ä»¶å¤„ç†æ­£ç¡®

### å¤±è´¥è¯Šæ–­

#### **å¸¸è§é—®é¢˜**

1. **æ’åä¸åˆç†**
   ```
   ç—‡çŠ¶: é«˜åˆ†ç©å®¶è·å¾—ä½æ’å
   åŸå› : å†å²æ•°æ®ä¸è¶³æˆ–æŠ€èƒ½è¯„ä¼°åå·®
   è§£å†³: æ£€æŸ¥ç©å®¶å†å²æ•°æ®ï¼Œè°ƒæ•´æŠ€èƒ½è®¡ç®—æƒé‡
   ```

2. **ä¿¡å¿ƒåº¦è¿‡ä½**
   ```
   ç—‡çŠ¶: æ‰€æœ‰æ¨èä¿¡å¿ƒåº¦ < 0.5
   åŸå› : æ•°æ®ä¸è¶³æˆ–ä¸€è‡´æ€§å·®
   è§£å†³: å¢åŠ å†å²æ•°æ®è¦æ±‚ï¼Œä¼˜åŒ–ä¸€è‡´æ€§è®¡ç®—
   ```

3. **æ€§èƒ½é—®é¢˜**
   ```
   ç—‡çŠ¶: å“åº”æ—¶é—´ > 200ms
   åŸå› : æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡ä½æˆ–è®¡ç®—å¤æ‚
   è§£å†³: ä¼˜åŒ–æŸ¥è¯¢ï¼Œæ·»åŠ ç´¢å¼•ï¼Œç®€åŒ–è®¡ç®—é€»è¾‘
   ```

4. **AIç”Ÿæˆå¼‚å¸¸**
   ```
   ç—‡çŠ¶: AIåˆ†æ•°ä¸åˆç†æˆ–éš¾åº¦åˆ†å¸ƒå¼‚å¸¸
   åŸå› : AIç”Ÿæˆç®—æ³•å‚æ•°ä¸å½“
   è§£å†³: è°ƒæ•´AIç”Ÿæˆç­–ç•¥å’Œå‚æ•°
   ```

## ğŸ› ï¸ è‡ªå®šä¹‰æµ‹è¯•

### åˆ›å»ºè‡ªå®šä¹‰æµ‹è¯•åœºæ™¯

```typescript
// è‡ªå®šä¹‰æµ‹è¯•åœºæ™¯
async function customScenarioTest() {
    const scenarios = [
        {
            name: "é«˜æ‰‹äº‘é›†",
            players: [
                { uid: "pro1", score: 15000 },
                { uid: "pro2", score: 14500 },
                { uid: "pro3", score: 14000 }
            ],
            aiCount: 5,
            expectedPattern: "ç«äº‰æ¿€çƒˆï¼Œæ’åæ¥è¿‘"
        },
        {
            name: "æ–°æ‰‹å‹å¥½",
            players: [
                { uid: "newbie1", score: 2000 },
                { uid: "newbie2", score: 2500 }
            ],
            aiCount: 4,
            expectedPattern: "æ”¯æŒæ€§AIå±…å¤š"
        }
    ];
    
    for (const scenario of scenarios) {
        console.log(`æµ‹è¯•åœºæ™¯: ${scenario.name}`);
        const result = await rankingManager.generateMatchRankings(
            scenario.players, 
            scenario.aiCount
        );
        
        // è‡ªå®šä¹‰éªŒè¯é€»è¾‘
        validateScenario(result, scenario);
    }
}
```

### æ·»åŠ æ–°çš„æµ‹è¯•æŒ‡æ ‡

```typescript
// æ‰©å±•æµ‹è¯•æŒ‡æ ‡
interface ExtendedTestResult {
    // åŸºæœ¬æŒ‡æ ‡
    success: boolean;
    responseTime: number;
    
    // ä¸šåŠ¡æŒ‡æ ‡  
    rankingFairness: number;      // æ’åå…¬å¹³æ€§è¯„åˆ†
    aiDiversityScore: number;     // AIå¤šæ ·æ€§è¯„åˆ†
    userSatisfactionEst: number;  // ç”¨æˆ·æ»¡æ„åº¦ä¼°è®¡
    
    // æŠ€æœ¯æŒ‡æ ‡
    memoryUsage: number;
    cacheHitRate: number;
}
```

## ğŸ“ æµ‹è¯•æŠ¥å‘Š

### è‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆ

æµ‹è¯•ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šï¼š

```json
{
    "testSuite": "æ¨èæ’åç³»ç»Ÿå®Œæ•´æµ‹è¯•",
    "timestamp": "2024-01-20T10:30:00Z",
    "summary": {
        "totalTests": 13,
        "passed": 12,
        "failed": 1,
        "successRate": 92.3
    },
    "performance": {
        "averageResponseTime": 45.2,
        "qps": 22.1,
        "memoryUsage": "12.5MB"
    },
    "coverage": {
        "functionalTests": "100%",
        "edgeCases": "90%",
        "performanceTests": "100%"
    }
}
```

## ğŸ”„ æŒç»­æµ‹è¯•

### é›†æˆåˆ°CI/CD

```yaml
# ç¤ºä¾‹CIé…ç½®
test-ranking-system:
  steps:
    - name: Quick Validation
      run: convex run scoreThresholdControl:runQuickRankingTest
    
    - name: Performance Benchmark  
      run: convex run scoreThresholdControl:runFullRankingTest
      
    - name: Generate Report
      run: convex run scoreThresholdControl:getTestStatus
```

### ç›‘æ§å’Œå‘Šè­¦

```typescript
// ç›‘æ§æŒ‡æ ‡
const healthCheck = {
    responseTime: '< 100ms',
    successRate: '> 95%',
    memoryUsage: '< 50MB',
    errorRate: '< 1%'
};
```

## ğŸ¯ æœ€ä½³å®è·µ

### æµ‹è¯•ç­–ç•¥

1. **åˆ†å±‚æµ‹è¯•**: å•å…ƒæµ‹è¯• â†’ é›†æˆæµ‹è¯• â†’ ç«¯åˆ°ç«¯æµ‹è¯•
2. **æ•°æ®é©±åŠ¨**: ä½¿ç”¨çœŸå®çš„å†å²æ•°æ®è¿›è¡Œæµ‹è¯•
3. **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**: æ‰€æœ‰æµ‹è¯•éƒ½åº”è¯¥èƒ½è‡ªåŠ¨æ‰§è¡Œ
4. **æŒç»­ç›‘æ§**: å®šæœŸè¿è¡Œæµ‹è¯•ï¼Œç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶æ€

### æµ‹è¯•æ•°æ®ç®¡ç†

1. **æ•°æ®éš”ç¦»**: æµ‹è¯•æ•°æ®ä¸ç”Ÿäº§æ•°æ®åˆ†ç¦»
2. **æ•°æ®æ¸…ç†**: æµ‹è¯•åæ¸…ç†ä¸´æ—¶æ•°æ®
3. **æ•°æ®ç‰ˆæœ¬**: ç»´æŠ¤ä¸åŒç‰ˆæœ¬çš„æµ‹è¯•æ•°æ®é›†
4. **æ•°æ®å®‰å…¨**: ä¸åœ¨æµ‹è¯•ä¸­ä½¿ç”¨çœŸå®ç”¨æˆ·æ•°æ®

### é—®é¢˜æ’æŸ¥

1. **æ—¥å¿—è®°å½•**: è¯¦ç»†è®°å½•æµ‹è¯•è¿‡ç¨‹å’Œç»“æœ
2. **é”™è¯¯åˆ†ç±»**: åŒºåˆ†åŠŸèƒ½é”™è¯¯ã€æ€§èƒ½é—®é¢˜ã€æ•°æ®é—®é¢˜
3. **å›å½’æµ‹è¯•**: ä¿®å¤åè¿›è¡Œå›å½’æµ‹è¯•
4. **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°æµ‹è¯•æ–‡æ¡£å’Œå·²çŸ¥é—®é¢˜

## ğŸ“ æ”¯æŒå’Œåé¦ˆ

å¦‚æœåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥æµ‹è¯•æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
2. å‚è€ƒæœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
3. è¿è¡Œå•é¡¹æµ‹è¯•å®šä½é—®é¢˜
4. æŸ¥çœ‹ç³»ç»Ÿç›‘æ§æŒ‡æ ‡
5. è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ”¯æŒ

---

**æµ‹è¯•ç³»ç»Ÿç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024å¹´1æœˆ  
**ç»´æŠ¤çŠ¶æ€**: âœ… æ´»è·ƒç»´æŠ¤
